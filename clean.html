<!DOCTYPE html>
<html lang="ar">

<head>
    <meta charset="UTF-8">
    <title>Firebase Matches Cleaner</title>
</head>

<body>
    <h2>ØªØ´ØºÙŠÙ„ ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª</h2>
    <button id="startClean">Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªÙ†Ø¸ÙŠÙ</button>
    <pre id="log"></pre>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, collection, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        // --- CONFIG ---
        const firebaseConfig = {
            apiKey: "AIzaSyB6ACvhgth3VXhoJJnNOZfIQBpXlTVWcGE",
            authDomain: "website-f388d.firebaseapp.com",
            projectId: "website-f388d",
            storageBucket: "website-f388d.appspot.com",
            messagingSenderId: "531820596793",
            appId: "1:531820596793:web:37dbfd0b9a3c7a3a0cc7e8",
            measurementId: "G-75KT28HL7H"
        };

        // Init
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
console.log("db",db);
        const logBox = document.getElementById("log");
        function log(msg) {
            logBox.textContent += msg + "\n";
        }

        async function cleanMatches() {
            log("ğŸš€ Starting cleaning process...");

            try {
                const matchesRef = collection(db, "matches");
                const snapshot = await getDocs(matchesRef);

                if (snapshot.empty) {
                    log("âŒ No matches found.");
                    return;
                }

                for (let matchDoc of snapshot.docs) {
                    const matchId = matchDoc.id;

                    try {
                        const stateUrl = `https://ko.best-goal.live/state.php?match_id=${matchId}`;
                        const res = await fetch(stateUrl);
                        const data = await res.json();

                        const status = data["Match-Status"] || "";

                        if (!status || status.includes("Ø¥Ù†ØªÙ‡Øª Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©")) {
                            await deleteDoc(doc(db, "matches", matchId));
                            log(`ğŸ—‘ï¸ Deleted match: ${matchId}`);
                        } else {
                            log(`â© Match still active: ${matchId}`);
                        }
                    } catch (err) {
                        log(`âš ï¸ Error checking match ${matchId}: ${err.message}`);
                    }
                }
            } catch (err) {
                log(`âŒ Error fetching matches: ${err.message}`);
            }

            log("ğŸ¯ Cleaning done!");
        }

        document.getElementById("startClean").addEventListener("click", cleanMatches);
    </script>
</body>


</html>
